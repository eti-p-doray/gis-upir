<!DOCTYPE html>
<html>
<head>
<title>Hello</title>
<link rel="stylesheet" href="http://openlayers.org/en/v3.18.2/css/ol.css" type="text/css">
<script src="http://openlayers.org/en/v3.18.2/build/ol.js" type="text/javascript"></script>
<script src="resources/proj4.js"></script>
<script src="resources/papaparse.js"></script>
<script src="resources/shp.min.js"></script>
<script src="resources/jquery-3.1.1.js"></script>
<script>

function Map() {
  this.map = new ol.Map({
    target: 'map',
    layers: [
      new ol.layer.Tile({
        source: new ol.source.OSM()
      })
    ],
    view: new ol.View({
      center: [-73, 45],
      zoom: 9,
      projection: 'EPSG:4326'
    })
  });

  function getMethods(obj)
{
    var res = [];
    for(var m in obj) {
        if(typeof obj[m] == "function") {
            res.push(m)
        }
    }
    return res;
}

  this.selectInteraction = new ol.interaction.Select();
  this.selectInteraction.getFeatures().on("add", function (e) { 
    console.log(e.element.getProperties());
  });
  this.map.addInteraction(this.selectInteraction);
}

Map.prototype.addLayer = function(geojson, styleFunction) {
  var vectorSource = new ol.source.Vector({
    features: (new ol.format.GeoJSON()).readFeatures(geojson)
  });
  var vectorLayer = new ol.layer.Vector({
    source: vectorSource,
    style: styleFunction
  });
  this.map.addLayer(vectorLayer);
  console.log(geojson);
}

Map.prototype.addShp = function(name, styleFunction) {
  shp("http://localhost:8000/data/" + name).then(function(geojson){
    this.addLayer(geojson, styleFunction);
  }.bind(this));
}


function Controller() {
  this.fileInput = document.querySelector('#fileInput');
}

Controller.prototype.bind = function() {
  this.map = new Map();
  this.map.addShp("geobase_montreal/GEOBASE_MTL", function(feature) {
    return new ol.style.Style({
      stroke: new ol.style.Stroke({
        color: 'green',
        width: 1
      })
    });
  });
  this.map.addShp("cycling_facilities/Existant_Reseau_cyclable_2013_polyline", function(feature) {
    return new ol.style.Style({
      stroke: new ol.style.Stroke({
        color: 'blue',
        width: 1
      })
    });
  });
  this.map.addShp("intersections/intersections_on_bike_network_with_change_in_road_type");
  //this.map.addShp("bike_path/Chunk_1");
  //this.map.addShp("bike_path/_Chunk_1");
};

document.addEventListener('DOMContentLoaded', function() {
  var contr = new Controller();
  contr.bind();
});

</script>
</head>

<body>
  <div>
    <div id="map" style="width: 100%, height: 400px"></div>
  </div>
  <div>
    <input id="fileInput" type="file">
  </div>
</body>
</html>